import{x as pe,j as P,o as be,a as r,b as t,l as Q,w as H,d as m,t as d,F as S,r as q,y as xe,p as z,m as F,z as G,i as ye,T as he,A as ke,B as we,e as v,g as _e,f as u,s as Ce,h as o,n as X,u as Ie}from"./index-CJeJ__NP.js";const je={class:"min-h-screen bg-white"},Me={class:"mx-auto max-w-7xl px-4 py-8 md:px-6 md:py-10"},Se={class:"mb-4 text-xs font-medium text-gray-500","aria-label":"Breadcrumb"},qe={class:"flex flex-wrap items-center gap-1"},Ae={key:0},Ne={key:1,class:"text-gray-400"},Le={class:"text-gray-800"},$e={key:0,class:"mb-6 text-center text-red-500"},Be={key:1,class:"grid min-h-[70vh] grid-cols-1 gap-8 lg:grid-cols-2 lg:gap-12"},Te={class:"flex flex-col"},De={class:"mt-4 flex gap-2 overflow-x-auto pb-2"},Pe={key:2,class:"grid min-h-[70vh] grid-cols-1 gap-8 lg:grid-cols-2 lg:gap-12"},Ve={class:"flex flex-col"},Ee={class:"relative flex min-h-[280px] w-full items-center justify-center overflow-hidden rounded-2xl md:min-h-[320px] md:aspect-square"},Re=["src","alt"],Oe={class:"mt-4 flex gap-2 overflow-x-auto pb-2"},Ue=["onClick"],Qe=["src","alt"],He={class:"flex flex-col"},ze={class:"text-2xl font-semibold tracking-tight text-gray-900 md:text-3xl"},Fe={key:0,class:"mt-1 text-xs font-semibold uppercase tracking-widest text-[#141642]/70"},Ge={class:"mt-2 text-sm text-gray-500"},Xe={class:"font-medium text-gray-700"},Je={class:"mt-4 text-2xl font-semibold text-[#141642]"},Ke={key:1,class:"mt-3 rounded-lg bg-amber-50 px-4 py-3 text-sm font-medium text-amber-800"},We={key:2,class:"mt-4 space-y-3"},Ye={class:"block text-sm font-medium text-gray-700"},Ze={class:"mt-2 flex flex-wrap gap-2"},et=["onClick"],tt={key:0,class:"text-sm text-amber-600"},at={class:"mt-5 rounded-xl border border-gray-200 bg-gray-50/60 px-4 py-4"},st={class:"mt-2 text-sm leading-relaxed text-gray-600"},nt={class:"mt-8"},ot={class:"mt-2 flex items-center gap-3"},rt=["disabled"],lt=["max"],it=["disabled"],ut={key:0,class:"mt-3 text-sm text-gray-500"},dt={key:1,class:"mt-6 rounded-xl border border-[#141642]/20 bg-[#141642]/5 px-4 py-4"},ct={class:"mt-3 grid gap-3 sm:grid-cols-2"},vt=["disabled"],gt={key:2,class:"mt-8 rounded-2xl border border-gray-200 bg-gray-50/50"},mt={class:"divide-y divide-gray-200/80"},ft={class:"h-14 w-14 shrink-0 overflow-hidden rounded-xl bg-white shadow-sm"},pt=["src","alt"],bt={class:"min-w-0 flex-1"},xt={class:"truncate font-medium text-gray-900"},yt={class:"text-sm font-semibold text-[#141642]"},ht={class:"flex shrink-0 items-center gap-1"},kt=["disabled","onClick"],wt=["value","max","onInput"],_t=["disabled","onClick"],Ct=["disabled","onClick"],C=1,St={__name:"ProductDetailView",setup(It){const W=Ce(),A=pe(),l=v({name:"",reference:"",price:0,quantity:0,currency:"CLP",description:"",images:[],categories:[],combinations:[]}),V=v(!1),N=v(""),f=v(0),c=v(1),k=v(!1),y=v({}),L=v({}),$=v(null),p=v(""),b=v("");function Y(){return typeof localStorage>"u"?!1:!!(localStorage.getItem("lmdn_reservation_start")&&localStorage.getItem("lmdn_reservation_end"))}const B=v(!1),w=u(()=>A.items.length===0&&!B.value),_=u(()=>l.value.images??[]),Z=u(()=>_.value[f.value]||_.value[0]),I=u(()=>_.value.length),ee=u(()=>{var s;const a=g.value;if(!((s=a==null?void 0:a.images)!=null&&s.length))return 0;const e=a.images[0],n=_.value.findIndex(i=>i===e);return n>=0?n:0}),j=u(()=>l.value.combinations??[]),T=u(()=>j.value.length>0);function J(a){const e=a.attributes??[];return e.length===0?a.reference||`Variante #${a.id}`:e.map(n=>n.value).join(" · ")}function te(a){const e=a.images??[];return e.length>0&&e[0]?e[0]:_.value[0]||"/img/colecciones/vajillas.webp"}function h(a){return L.value[a.id]??0}function D(a,e){const n=Math.max(0,Math.min(99,Number(e)||0));L.value={...L.value,[a.id]:n}}function ae(a){const e=Math.min(99,a.quantity??0),n=h(a);D(a,Math.min(n+1,e))}function se(a){const e=h(a);D(a,Math.max(0,e-1))}async function ne(a){const e=h(a);if(!(e<=0||(a.quantity??0)<=0)&&!(w.value&&(!p.value||!b.value)))try{w.value&&(localStorage.setItem("lmdn_reservation_start",p.value),localStorage.setItem("lmdn_reservation_end",b.value),B.value=!0),$.value=a.id,await A.addProduct({productId:l.value.id,quantity:e,combinationId:a.id}),D(a,0),k.value=!0,setTimeout(()=>{k.value=!1},3e3)}catch{}finally{$.value=null}}const K=u(()=>{const a={};for(const e of j.value)for(const n of e.attributes??[]){const s=n.group||"Opción";a[s]||(a[s]=new Set),a[s].add(n.value)}return Object.fromEntries(Object.entries(a).map(([e,n])=>[e,[...n]]))}),g=u(()=>{const a=y.value,e=Object.keys(K.value);if(e.length===0)return null;for(const n of e)if(!a[n])return null;return j.value.find(n=>{const s=n.attributes??[];return e.every(i=>s.some(x=>x.group===i&&x.value===a[i]))})??null}),oe=u(()=>g.value?g.value.price:l.value.price??0),re=u(()=>{var a;return(a=g.value)!=null&&a.reference?g.value.reference:l.value.reference??""}),E=u(()=>g.value?g.value.quantity??0:l.value.quantity??0),M=u(()=>Math.min(99,Math.max(C,E.value))),le=u(()=>T.value&&!g.value||E.value<=0?!1:w.value?!!(p.value&&b.value):!0),ie=u(()=>(l.value.quantity??0)===0),R=u(()=>{var a,e;return((e=(a=l.value.categories)==null?void 0:a[0])==null?void 0:e.name)??""}),O=u(()=>{var a,e;return((e=(a=l.value.categories)==null?void 0:a[0])==null?void 0:e.slug)??""});function ue(a,e){y.value={...y.value,[a]:e}}function de(){I.value!==0&&(f.value=(f.value-1+I.value)%I.value)}function ce(){I.value!==0&&(f.value=(f.value+1)%I.value)}function ve(){c.value>C&&c.value--}function ge(){c.value<M.value&&c.value++}async function me(){var a;try{w.value&&p.value&&b.value&&(localStorage.setItem("lmdn_reservation_start",p.value),localStorage.setItem("lmdn_reservation_end",b.value),B.value=!0),await A.addProduct({productId:l.value.id,quantity:c.value,combinationId:((a=g.value)==null?void 0:a.id)??void 0}),k.value=!0,setTimeout(()=>{k.value=!1},3e3)}catch{}}P(c,a=>{const e=Number(a);Number.isNaN(e)||e<C?c.value=C:e>M.value&&(c.value=M.value)}),P(j,a=>{a.length>0&&Object.keys(y.value).length===0&&(y.value={}),L.value={}},{immediate:!0}),P(ee,a=>{f.value=a});function U(){var e;const a=(e=l.value)==null?void 0:e.name;document.title=a?`${a} | La Mesa de Nora`:"La Mesa de Nora - EXCLUSIVE RENTAL"}P(()=>{var a;return(a=l.value)==null?void 0:a.name},U,{immediate:!0});async function fe(){const a=W.params.slug;if(a){V.value=!0,N.value="",y.value={};try{const n=(await we(a)).data??{},s=Array.isArray(n.images)&&n.images.length?n.images:n.cover?[n.cover]:["/img/colecciones/vajillas.webp"];l.value={id:n.id??null,name:n.name??"",reference:n.reference??"",price:n.price??0,quantity:n.quantity??0,currency:"CLP",description:n.description??"",images:s,categories:Array.isArray(n.categories)?n.categories:[],combinations:Array.isArray(n.combinations)?n.combinations:[]},f.value=0,c.value=1,U()}catch{N.value="No se pudo cargar la información del producto."}finally{V.value=!1}}}return be(()=>{U(),fe(),B.value=Y()}),(a,e)=>{const n=_e("RouterLink");return o(),r("div",je,[t("div",Me,[t("nav",Se,[t("ol",qe,[t("li",null,[Q(n,{to:"/",class:"hover:text-[#141642]"},{default:H(()=>[...e[4]||(e[4]=[z(d("INICIO"),-1)])]),_:1})]),e[5]||(e[5]=t("li",{class:"text-gray-400"},"/",-1)),O.value?(o(),r("li",Ae,[Q(n,{to:`/colecciones/${O.value}`,class:"hover:text-[#141642]"},{default:H(()=>[z(d((R.value||"COLECCIÓN").toUpperCase()),1)]),_:1},8,["to"])])):m("",!0),O.value?(o(),r("li",Ne,"/")):m("",!0),t("li",Le,d((l.value.name||"PRODUCTO").toUpperCase()),1)])]),N.value?(o(),r("p",$e,d(N.value),1)):V.value?(o(),r("div",Be,[t("div",Te,[e[6]||(e[6]=t("div",{class:"relative flex min-h-[280px] w-full items-center justify-center overflow-hidden rounded-2xl bg-gray-100 md:min-h-[320px] md:aspect-square"},[t("div",{class:"h-full w-full animate-pulse bg-gray-200"})],-1)),t("div",De,[(o(),r(S,null,q(4,s=>t("div",{key:s,class:"h-20 w-20 shrink-0 rounded-lg border-2 border-transparent bg-gray-100 animate-pulse"})),64))])]),e[7]||(e[7]=xe('<div class="flex flex-col space-y-4"><div class="h-7 w-2/3 rounded bg-gray-100 animate-pulse"></div><div class="h-4 w-1/3 rounded bg-gray-100 animate-pulse"></div><div class="h-8 w-1/4 rounded bg-gray-100 animate-pulse"></div><div class="h-24 w-full rounded-xl bg-gray-100 animate-pulse"></div><div class="h-24 w-full rounded-xl bg-gray-100 animate-pulse"></div></div>',1))])):(o(),r("div",Pe,[t("div",Ve,[t("div",Ee,[t("img",{src:Z.value,alt:l.value.name,class:"max-h-full max-w-full object-contain object-center"},null,8,Re),t("button",{type:"button",class:"absolute left-3 top-1/2 -translate-y-1/2 rounded-full bg-white/90 p-2 text-gray-700 shadow-md transition hover:bg-white focus:outline-none focus:ring-2 focus:ring-[#141642]/30","aria-label":"Imagen anterior",onClick:de},[...e[8]||(e[8]=[t("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),t("button",{type:"button",class:"absolute right-3 top-1/2 -translate-y-1/2 rounded-full bg-white/90 p-2 text-gray-700 shadow-md transition hover:bg-white focus:outline-none focus:ring-2 focus:ring-[#141642]/30","aria-label":"Imagen siguiente",onClick:ce},[...e[9]||(e[9]=[t("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])]),t("div",Oe,[(o(!0),r(S,null,q(_.value,(s,i)=>(o(),r("button",{key:`${i}-${s}`,type:"button",class:X(["h-20 w-20 shrink-0 overflow-hidden rounded-lg border-2 transition focus:outline-none focus:ring-2 focus:ring-[#141642]",f.value===i?"border-[#141642]":"border-gray-200 hover:border-gray-300"]),onClick:x=>f.value=i},[t("img",{src:s,alt:`${l.value.name} ${i+1}`,class:"h-full w-full object-cover"},null,8,Qe)],10,Ue))),128))])]),t("div",He,[t("h1",ze,d((l.value.name||"").toUpperCase()),1),R.value?(o(),r("p",Fe,d(R.value.toUpperCase()),1)):m("",!0),t("p",Ge,[e[10]||(e[10]=z(" Referencia: ",-1)),t("span",Xe,d(re.value),1)]),t("p",Je," $"+d(oe.value.toLocaleString("es-CL")),1),ie.value?(o(),r("p",Ke," Este producto no tiene stock disponible en este momento. ")):m("",!0),T.value?(o(),r("div",We,[(o(!0),r(S,null,q(K.value,(s,i)=>(o(),r("div",{key:i},[t("label",Ye,d(i),1),t("div",Ze,[(o(!0),r(S,null,q(s,x=>(o(),r("button",{key:x,type:"button",class:X(["rounded-lg border-2 px-4 py-2 text-sm font-medium transition focus:outline-none focus:ring-2 focus:ring-[#141642]/30",y.value[i]===x?"border-[#141642] bg-[#141642]/5 text-[#141642]":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"]),onClick:jt=>ue(i,x)},d(x),11,et))),128))])]))),128)),E.value<=0&&g.value?(o(),r("p",tt," Esta combinación no está disponible en stock. ")):m("",!0)])):m("",!0),t("div",at,[e[11]||(e[11]=t("h2",{class:"text-sm font-semibold uppercase tracking-wide text-[#141642]"},"Descripcion",-1)),t("p",st,d(l.value.description),1)]),t("div",nt,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),t("div",ot,[t("button",{type:"button",disabled:c.value<=C,class:"flex h-11 w-11 shrink-0 items-center justify-center rounded-lg border-2 border-gray-200 bg-white text-[#141642] transition hover:border-[#141642] hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-[#141642]/30","aria-label":"Disminuir cantidad",onClick:ve},[...e[12]||(e[12]=[t("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 12H4"})],-1)])],8,rt),F(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),type:"number",min:C,max:M.value,class:"h-11 w-20 rounded-lg border-2 border-gray-200 text-center text-lg font-medium text-[#141642] focus:border-[#141642] focus:ring-2 focus:ring-[#141642]/20 [appearance:textfield] [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none"},null,8,lt),[[G,c.value,void 0,{number:!0}]]),t("button",{type:"button",disabled:c.value>=M.value,class:"flex h-11 w-11 shrink-0 items-center justify-center rounded-lg border-2 border-gray-200 bg-white text-[#141642] transition hover:border-[#141642] hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-[#141642]/30","aria-label":"Aumentar cantidad",onClick:ge},[...e[13]||(e[13]=[t("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])],8,it)]),T.value&&!g.value?(o(),r("p",ut," Selecciona las opciones para continuar. ")):m("",!0),w.value?(o(),r("div",dt,[e[16]||(e[16]=t("p",{class:"text-xs font-semibold uppercase tracking-wider text-[#141642]"}," Fechas de tu evento ",-1)),e[17]||(e[17]=t("p",{class:"mt-1 text-sm text-gray-600"}," Indica el rango de fechas para tu reserva. Solo se solicita una vez. ",-1)),t("div",ct,[t("div",null,[e[14]||(e[14]=t("label",{class:"block text-xs font-medium text-gray-700"},"Fecha inicio",-1)),F(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>p.value=s),type:"date",class:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-[#141642] focus:ring-2 focus:ring-[#141642]/20"},null,512),[[G,p.value]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-xs font-medium text-gray-700"},"Fecha término",-1)),F(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>b.value=s),type:"date",class:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-[#141642] focus:ring-2 focus:ring-[#141642]/20"},null,512),[[G,b.value]])])])])):m("",!0),t("button",{type:"button",disabled:!le.value,class:"mt-4 w-full rounded-lg bg-[#141642] px-6 py-3.5 font-semibold text-white transition hover:bg-[#141642]/90 focus:outline-none focus:ring-2 focus:ring-[#141642] focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60",onClick:me}," Agregar al carrito ",8,vt),T.value?(o(),r("div",gt,[e[20]||(e[20]=t("div",{class:"border-b border-gray-200 bg-white/80 px-4 py-3"},[t("h3",{class:"text-sm font-semibold uppercase tracking-wider text-[#141642]"}," Agregar variantes "),t("p",{class:"mt-0.5 text-xs text-gray-500"}," Añade varias variantes a la vez ")],-1)),t("div",mt,[(o(!0),r(S,null,q(j.value,s=>(o(),r("div",{key:s.id,class:"flex items-center gap-4 px-4 py-3 transition-colors hover:bg-white/50"},[t("div",ft,[t("img",{src:te(s),alt:J(s),class:"h-full w-full object-cover"},null,8,pt)]),t("div",bt,[t("p",xt,d(l.value.name)+" — "+d(J(s)),1),t("p",yt," $"+d((s.price??0).toLocaleString("es-CL")),1)]),t("div",ht,[t("button",{type:"button",disabled:h(s)<=0,class:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-200 bg-white text-gray-600 transition hover:bg-gray-50 disabled:opacity-40",onClick:i=>se(s)},[...e[18]||(e[18]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 12H4"})],-1)])],8,kt),t("input",{value:h(s),type:"number",min:"0",max:Math.min(99,s.quantity??0),class:"h-9 w-14 rounded-lg border border-gray-200 text-center text-sm [appearance:textfield] [&::-webkit-inner-spin-button]:appearance-none",onInput:i=>D(s,i.target.value)},null,40,wt),t("button",{type:"button",disabled:h(s)>=Math.min(99,s.quantity??0),class:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-200 bg-white text-gray-600 transition hover:bg-gray-50 disabled:opacity-40",onClick:i=>ae(s)},[...e[19]||(e[19]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])],8,_t)]),t("button",{type:"button",disabled:h(s)<=0||(s.quantity??0)<=0||w.value&&(!p.value||!b.value),class:X(["shrink-0 rounded-lg bg-[#141642] px-4 py-2 text-xs font-semibold text-white transition hover:bg-[#141642]/90 disabled:cursor-not-allowed disabled:opacity-50",$.value===s.id?"opacity-70":""]),onClick:i=>ne(s)},d($.value===s.id?"...":"+ Agregar"),11,Ct)]))),128))])])):m("",!0)])])]))]),(o(),ye(ke,{to:"body"},[Q(he,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"translate-x-full opacity-0","enter-to-class":"translate-x-0 opacity-100","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"translate-x-0 opacity-100","leave-to-class":"translate-x-full opacity-0"},{default:H(()=>[k.value?(o(),r("button",{key:0,type:"button",class:"fixed bottom-6 right-6 z-[9999] flex items-center gap-3 rounded-xl border border-[#141642]/20 bg-white px-4 py-3 shadow-lg ring-1 ring-black/5 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-[#141642] focus:ring-offset-2",onClick:e[3]||(e[3]=s=>{Ie(A).openSidebar(),k.value=!1})},[...e[22]||(e[22]=[t("span",{class:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-green-100 text-green-600"},[t("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1),t("span",{class:"text-left"},[t("span",{class:"block text-sm font-semibold text-gray-900"},"Producto agregado al carrito"),t("span",{class:"text-xs text-gray-500"},"Haz clic para ver el carrito")],-1),t("svg",{class:"h-5 w-5 shrink-0 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])):m("",!0)]),_:1})]))])}}};export{St as default};
